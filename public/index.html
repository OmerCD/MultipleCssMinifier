<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="preload" href="index.css" as="style" onload="this.rel='stylesheet'">
</head>
<body>
<input type="file" multiple onchange="handleFiles(this)" accept="text/css">
<script>
    let keys = [];

    function handleFiles(e) {
        console.log(e.files);

        readFile(e.files,0);


    }

    function readFile(files,cur) {
        console.log(files[cur])
        var fr = new FileReader();
        fr.onload = function () {
            keys.push(fr.result)
            if (cur < files.length-1) {
                readFile(files,cur+1);
            }else   {
                sendRequest(keys);
            }
        }
        fr.readAsText(files[cur]);

    }

    function sendRequest(keys) {

        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        const raw = JSON.stringify({
            "cssText": keys
        });

        const requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };

        fetch("http://localhost:4545/MinifyCss", requestOptions)
            .then(response => response.text())
            .then(result => console.log(result))
            .catch(error => console.log('error', error));
    }

</script>
</body>
</html>